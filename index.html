<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Milli Sesli Asistan</title>
    <style>
        .milli-asistan-container {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: #ffffff;
            border: 2px solid #c0392b;
            border-radius: 15px;
            padding: 20px;
            max-width: 600px;
            margin: 20px auto;
            text-align: center;
        }
        .ekran {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            min-height: 150px;
            margin-bottom: 20px;
            border: 1px inset #eee;
        }
        .soru-metni { color: #7f8c8d; font-style: italic; margin-bottom: 10px; font-size: 14px; }
        .cevap-metni { color: #2c3e50; font-size: 18px; font-weight: bold; line-height: 1.5; }
        
        .kontrol-merkezi { display: flex; gap: 10px; justify-content: center; align-items: center; }
        
        /* Buton Stilleri */
        .asistan-btn {
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            color: white;
        }
        .gonder-btn { background: #c0392b; }
        .mikrofon-btn { background: #2980b9; }
        .mikrofon-btn.dinliyor { background: #27ae60; animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }
        
        input#userInput {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
        }
    </style>
</head>
<body>

<div class="milli-asistan-container">
    <h3 style="color: #c0392b; margin-top: 0;">MİLLİ ASİSTAN (Sesli)</h3>
    
    <div class="ekran" id="chatWindow">
        <div id="displayArea">
            <div class="cevap-metni">Sisteme Hoş Geldiniz. Mikrofonu kullanarak veya yazarak soru sorabilirsiniz.</div>
        </div>
    </div>

    <div class="kontrol-merkezi">
        <button id="micBtn" class="asistan-btn mikrofon-btn" title="Konuşmak için basın">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
        </button>
        
        <input type="text" id="userInput" placeholder="Mesajınızı yazın...">
        
        <button id="sendBtn" class="asistan-btn gonder-btn">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    </div>
    <div id="statusInfo" style="font-size: 11px; margin-top: 10px; color: #999;"></div>
</div>

<script type="importmap">
  {
    "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai@latest" }
  }
</script>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    const API_KEY = "AIzaSyAh8deBmwgA8dIFpLcAwsJI79CLdz5lKBQ"; 
    const genAI = new GoogleGenerativeAI(API_KEY);

    // KATI KURALLARIMIZ (ANAYASA)
    const sistemYonergesi = `
        Senin adın Milli Asistan. ŞU KURALLAR ASLA ÇİĞNENEMEZ:
        1. Cinsel içerikli hiçbir konuşma yapılamaz.
        2. Siyasi propaganda, parti taraftarlığı veya tartışması yapılamaz.
        3. Vatan, millet, bayrak ve anayasal düzene aykırı hiçbir ifade kullanılamaz.
        4. İslam ahlakına ve Türk halkının manevi değerlerine tam uyum sağlanmalıdır.
        5. Kural ihlali durumunda: "Bu konu değerlerimize ve güvenlik kurallarımıza aykırıdır." diyerek reddet.
    `;

    const model = genAI.getGenerativeModel({ 
        model: "gemini-2.5-flash",
        systemInstruction: sistemYonergesi 
    });

    const displayArea = document.getElementById('displayArea');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');
    const statusInfo = document.getElementById('statusInfo');

    // --- SESLİ CEVAP SİSTEMİ (TTS) ---
    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'tr-TR';
        window.speechSynthesis.speak(utterance);
    }

    // --- SES TANIMA SİSTEMİ (STT) ---
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (Recognition) {
        recognition = new Recognition();
        recognition.lang = 'tr-TR';
        recognition.continuous = false;

        recognition.onstart = () => {
            micBtn.classList.add('dinliyor');
            statusInfo.textContent = "Sizi dinliyorum...";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
            handleChat(); // Konuşma bitince otomatik gönder
        };

        recognition.onend = () => {
            micBtn.classList.remove('dinliyor');
            statusInfo.textContent = "";
        };
    }

    async function handleChat() {
        const prompt = userInput.value.trim();
        if (!prompt) return;

        displayArea.innerHTML = `<div class="soru-metni">"${prompt}"</div><div class="cevap-metni" id="loader">Düşünülüyor...</div>`;
        userInput.value = '';
        sendBtn.disabled = true;

        try {
            const result = await model.generateContent(prompt);
            const response = await result.response;
            const aiText = response.text();
            
            document.getElementById('loader').textContent = aiText;
            speak(aiText);

        } catch (error) {
            document.getElementById('loader').textContent = "Hata: " + error.message;
        } finally {
            sendBtn.disabled = false;
        }
    }

    // Olay Dinleyiciler
    sendBtn.addEventListener('click', handleChat);
    userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleChat(); });
    
    micBtn.addEventListener('click', () => {
        if (recognition) {
            recognition.start();
        } else {
            alert("Tarayıcınız ses tanımayı desteklemiyor. Lütfen Chrome kullanın.");
        }
    });
</script>

</body>
</html>
